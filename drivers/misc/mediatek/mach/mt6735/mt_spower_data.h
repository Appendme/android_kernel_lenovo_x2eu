#ifndef MT_SPOWER_CPU_H
#define MT_SPOWER_CPU_H



#define VSIZE 10
#define TSIZE 20
#define MAX_TABLE_SIZE 3

/**  PLEASE MAKE SURE the following things for table interpolation:
 * 1. table order: FF, TT, SS; such that, the order is necessarily obey as following:
 *       the power at (1150, 30) shoule be descent absoultely.
 **/

#define CPU_TABLE_0                                                   \
        /* "(WAT 11.57%) Leakage Power"	 */                             \
        /**/   	        800,	850,	900,	950,	1000,	1050,	1100,	1150,	1200,	1250, \
                25,	31,40,51,65,81,101,127,158,197,244, \
                30,	37,47,59,75,93,117,145,181,223,276, \
                35,	43,54,69,86,108,134,167,207,255,314, \
                40,	49,63,79,99,124,154,190,236,290,356, \
                45,	57,72,91,114,142,176,217,268,329,404, \
                50,	66,83,104,130,162,201,247,304,372,455, \
                55,	76,96,119,149,185,228,280,344,420,512, \
                60,	87,109,136,170,210,259,317,388,473,575, \
                65,	100,125,156,193,238,293,358,437,533,647, \
                70,	114,142,177,219,269,330,403,491,596,723, \
                75,	130,162,201,247,304,371,452,549,665,802, \
                80,	148,183,226,278,341,416,505,613,740,891, \
                85,	167,207,255,313,382,465,564,682,822,988, \
                90,	189,233,287,351,426,518,627,756,909,1091, \
                95,	212,262,321,391,475,575,694,835,1000,1195, \
                100,239,293,359,436,529,638,767,920,1101,1312, \
                105,267,327,399,485,586,706,847,1013,1209,1438, \
                110,298,365,445,538,649,780,933,1112,1324,1572, \
                115,333,407,494,596,718,860,1025,1219,1447,1712, \
                120,370,452,547,658,789,944,1125,1334,1579,1865


#define CPU_TABLE_1                                                   \
        /* "(WAT 0.78%) Leakage Power"  */                              \
        /**/   	        800,	850,	900,	950,	1000,	1050,	1100,	1150,	1200,	1250, \
                25,	26,33,42,53,66,83,104,131,162,201, \
                30,	30,38,49,61,77,96,120,150,186,231, \
                35,	35,45,56,71,89,111,138,171,212,263, \
                40,	41,52,65,82,102,127,158,196,242,299, \
                45,	48,60,75,94,118,146,181,223,275,338, \
                50,	55,69,87,108,135,167,206,254,311,382, \
                55,	64,80,100,124,154,190,234,287,352,431, \
                60,	73,92,114,142,175,216,265,325,397,484, \
                65,	84,105,131,161,199,244,300,366,446,542, \
                70,	96,120,149,183,225,276,337,411,500,606, \
                75,	110,137,169,208,255,311,379,461,559,676, \
                80,	126,155,192,235,287,350,425,516,624,751, \
                85,	143,176,217,264,322,392,476,575,694,834, \
                90,	161,200,244,296,360,438,530,641,769,922, \
                95,	182,224,274,332,402,488,589,709,850,1015, \
                100,204,250,304,370,448,540,651,782,936,1117, \
                105,230,280,340,412,498,600,720,862,1029,1225, \
                110,257,313,378,458,552,663,795,949,1130,1342, \
                115,288,349,421,508,609,730,874,1042,1237,1465, \
                120,321,388,467,562,672,803,957,1139,1350,1596
				
				
#define CPU_TABLE_2							\
        /*"(WAT -8.16%) Leakage Power" */                               \
        /**/  	        800,	850,	900,	950,	1000,	1050,	1100,	1150,	1200,	1250, \
				25,	9,11,14,18,23,28,36,45,56,69, \
				30,	10,13,17,21,26,33,41,52,64,80, \
				35,	12,15,19,25,31,39,48,60,74,92, \
				40,	14,18,23,29,36,45,56,69,86,106, \
				45,	17,21,26,33,41,51,64,79,98,120, \
				50,	20,25,31,38,48,59,73,91,111,137, \
				55,	23,29,36,45,55,68,84,104,127,156, \
				60,	27,33,41,51,64,78,97,118,145,176, \
				65,	31,39,48,59,73,90,110,135,164,199, \
				70,	36,45,56,69,84,103,126,153,186,226, \
				75,	42,52,64,79,97,118,143,174,211,255, \
				80,	49,60,74,91,110,134,163,198,238,288, \
				85,	56,69,85,104,126,153,185,224,269,323, \
				90,	65,80,98,119,144,174,210,253,303,363, \
				95,	75,91,111,135,163,196,236,284,339,405, \
				100,86,104,127,153,184,221,265,317,378,450, \
				105,98,120,145,174,210,251,299,356,422,502, \
				110,113,137,165,198,237,283,337,400,474,560, \
				115,129,156,187,225,268,319,378,447,528,622, \
				120,148,177,212,254,302,359,425,500,588,690


#define LTE_TABLE_0							\
        /* "(WAT 11.57%) Leakage Power"	 */                             \
        /**/  	        800,	850,	900,	950,	1000,	1050,	1100,	1150,	1200,	1250, \
                25,	14,15,15,16,17,18,19,19,20,21, \
                30,	17,18,19,20,21,22,23,24,25,26, \
                35,	21,22,23,24,25,26,28,29,30,31, \
                40,	25,26,28,29,31,32,34,35,36,38, \
                45,	30,32,34,35,37,39,41,42,44,46, \
                50,	36,39,40,42,45,47,49,51,53,55, \
                55,	44,46,49,51,54,56,59,61,64,66, \
                60,	53,56,59,62,65,67,70,73,76,79, \
                65,	63,67,71,74,77,81,84,88,92,95, \
                70,	76,81,85,89,93,97,101,105,110,113, \
                75,	91,97,102,107,112,117,121,126,131,136, \
                80,	109,115,121,127,133,139,145,151,156,162, \
                85,	131,138,145,151,158,166,173,179,186,193, \
                90,	156,164,172,181,189,197,204,212,220,229, \
                95,	185,196,206,215,224,233,243,253,262,272, \
                100,220,232,245,255,266,277,288,299,310,322, \
                105,261,275,289,302,316,329,341,353,364,378, \
                110,308,325,341,356,372,386,401,416,430,445, \
                115,364,382,401,419,436,455,472,489,506,524, \
                120,428,449,471,493,514,536,556,577,596,614

#define LTE_TABLE_1							\
        /* "(WAT 0.78%) Leakage Power" */                               \
        /**/ 	        800,	850,	900,	950,	1000,	1050,	1100,	1150,	1200,	1250, \
                25,	7,8,8,8,9,9,10,10,11,11, \
                30,	8,9,9,10,10,11,11,12,12,13, \
                35,	9,10,10,11,12,12,13,13,14,15, \
                40,	11,12,12,13,13,14,15,15,16,17, \
                45,	13,13,14,15,16,16,17,18,19,20, \
                50,	15,16,17,17,18,19,20,21,22,23, \
                55,	17,18,19,20,22,23,24,25,26,27, \
                60,	21,22,23,24,25,27,28,29,31,32, \
                65,	25,26,27,29,30,32,33,35,37,38, \
                70,	29,31,33,35,36,38,40,42,44,45, \
                75,	35,37,39,42,44,46,48,50,53,55, \
                80,	43,45,48,50,53,56,59,61,64,67, \
                85,	52,55,58,61,65,68,72,75,78,81, \
                90,	63,67,71,75,79,83,88,92,95,100, \
                95,	78,82,87,92,97,102,107,113,118,123, \
                100,96,102,108,115,121,126,132,139,145,152, \
                105,120,128,135,142,150,157,165,174,182,189, \
                110,150,161,169,177,186,196,205,215,227,238, \
                115,190,202,212,223,235,246,260,273,286,300, \
                120,239,253,268,282,297,315,331,345,360,379


#define LTE_TABLE_2							\
        /* "(WAT -8.16%) Leakage Power"	 */                             \
        /**/      	800,	850,	900,	950,	1000,	1050,	1100,	1150,	1200,	1250, \
				25,	12,13,14,14,15,16,17,17,18,19, \
				30,	13,14,15,15,16,17,18,19,19,20, \
				35,	14,15,16,17,18,18,19,20,21,22, \
				40,	15,16,17,18,19,20,21,22,23,24, \
				45,	17,18,19,20,21,22,23,24,25,26, \
				50,	19,20,21,22,23,24,26,27,28,29, \
				55,	21,22,23,25,26,27,28,30,31,33, \
				60,	24,25,26,28,29,31,32,34,35,37, \
				65,	27,28,30,31,33,35,36,38,40,42, \
				70,	31,32,34,36,38,40,42,43,45,47, \
				75,	35,37,39,41,44,46,48,50,52,55, \
				80,	41,43,46,48,51,53,56,58,61,64, \
				85,	48,51,53,56,59,62,65,68,71,74, \
				90,	57,60,63,66,70,74,77,80,84,87, \
				95,	67,71,75,79,83,87,91,95,99,104, \
				100,81,85,90,94,99,104,109,114,119,124, \
				105,97,103,108,114,120,125,131,138,144,150, \
				110,119,125,132,139,146,152,160,167,174,183, \
				115,146,154,162,171,179,187,196,205,214,225, \
				120,180,190,201,211,220,230,242,253,265,278

#define VCORE_TABLE_0							\
        /* "(WAT 11.57%) Leakage Power"	 */                             \
        /**/            800,	850,	900,	950,	1000,	1050,	1100,	1150,	1200,	1250, \
				25,	72,95,126,167,223,294,391,516,682,900, \
				30,	86,114,151,199,263,347,458,604,794,1046, \
				35,	103,136,179,236,310,408,537,703,923,1211, \
				40,	122,161,212,279,365,479,626,818,1068,1396, \
				45,	146,191,250,328,428,558,728,948,1233,1604, \
				50,	173,227,296,385,500,650,845,1094,1419,1837, \
				55,	205,267,348,452,585,754,974,1261,1627,2095, \
				60,	241,313,407,526,679,874,1126,1450,1861,2394, \
				65,	282,366,473,611,784,1006,1290,1656,2118,2712, \
				70,	329,426,549,705,904,1154,1473,1884,2403,3060, \
				75,	384,494,634,811,1037,1319,1678,2137,2716,3446, \
				80,	446,571,730,931,1184,1502,1905,2410,3056,3868, \
				85,	516,658,838,1064,1348,1708,2154,2717,3429,4323, \
				90,	595,756,959,1214,1532,1933,2429,3055,3832,4818, \
				95,	685,866,1094,1379,1735,2182,2731,3418,4271,5348, \
				100,783,986,1243,1560,1956,2450,3059,3814,4748,5909, \
				105,894,1123,1405,1759,2196,2740,3413,4241,5271,6525, \
				110,1014,1272,1587,1976,2459,3061,3798,4701,5808,7183, \
				115,1150,1430,1783,2217,2748,3403,4206,5179,6381,7853, \
				120,1299,1611,1995,2465,3050,3761,4632,5692,6978,8566


#define VCORE_TABLE_1							\
        /* "(WAT 0.78%) Leakage Power"	 */                             \
        /**/            800,	850,	900,	950,	1000,	1050,	1100,	1150,	1200,	1250, \
				25,	15,19,25,32,41,53,68,88,114,150, \
				30,	19,24,30,39,49,63,81,105,136,177, \
				35,	23,29,36,46,59,76,97,125,161,208, \
				40,	28,35,44,56,71,90,115,148,191,246, \
				45,	33,42,53,67,85,108,137,175,225,290, \
				50,	40,50,63,80,101,128,162,207,264,338, \
				55,	49,60,76,95,120,152,191,243,310,397, \
				60,	59,73,91,113,142,179,225,286,362,463, \
				65,	70,87,108,135,168,211,265,335,422,538, \
				70,	84,104,129,160,199,250,311,389,492,623, \
				75,	100,124,153,190,235,293,362,453,573,729, \
				80,	120,147,181,222,274,340,422,529,666,846, \
				85,	142,174,214,262,323,399,497,618,768,968, \
				90,	168,206,251,308,379,467,576,714,891,1108, \
				95,	200,243,296,359,440,539,670,829,1021,1270, \
				100,237,288,348,422,515,627,772,950,1172,1459, \
				105,276,336,407,490,596,725,883,1100,1350,1675, \
				110,323,390,472,569,687,834,1011,1256,1551,1910, \
				115,374,451,544,658,792,959,1155,1427,1744,2155, \
				120,435,522,630,753,913,1101,1324,1622,1982,2440, \

         


#define VCORE_TABLE_2							\
        /* "(WAT 11.57%) Leakage Power" */                              \
        /**/            800,	850,	900,	950,	1000,	1050,	1100,	1150,	1200,	1250, \
				25,	12,16,20,25,32,41,53,69,89,116, \
				30,	15,19,24,30,38,49,62,80,104,135, \
				35,	18,22,28,36,45,57,73,94,121,157, \
				40,	21,26,33,42,53,67,86,110,141,181, \
				45,	25,32,39,50,62,79,101,128,164,211, \
				50,	31,38,47,59,74,93,118,149,190,244, \
				55,	37,45,56,70,87,109,137,174,221,283, \
				60,	44,54,67,83,103,129,161,203,256,327, \
				65,	53,65,80,98,122,152,190,237,298,380, \
				70,	63,77,95,117,144,179,222,277,347,440, \
				75,	76,92,113,138,170,210,260,323,405,511, \
				80,	91,110,134,163,200,246,303,376,470,589, \
				85,	109,131,159,194,237,289,355,438,547,683, \
				90,	131,157,190,230,278,338,416,512,634,795, \
				95,	156,189,226,272,328,399,489,605,740,918, \
				100,189,225,269,322,387,469,573,702,863,1059, \
				105,228,269,319,380,456,552,672,816,996,1232, \
				110,274,322,381,453,542,651,781,954,1164,1422, \
				115,327,385,457,540,642,766,918,1113,1342,1650, \
				120,390,457,543,641,760,905,1087,1299,1558,1893




typedef struct spower_raw_s {
	int vsize;
	int tsize;
	int table_size;
	int *table[];
} spower_raw_t;


/** table order: ff, tt, ss **/

int cpu_leakage_data[][VSIZE*TSIZE+VSIZE+TSIZE] = {
		{ CPU_TABLE_0 },
		{ CPU_TABLE_1 },
		{ CPU_TABLE_2 },
};

int lte_leakage_data[][VSIZE*TSIZE+VSIZE+TSIZE] = {
		{ LTE_TABLE_0 },
		{ LTE_TABLE_1 },
		{ LTE_TABLE_2 },
};

int vcore_leakage_data[][VSIZE*TSIZE+VSIZE+TSIZE] = {
		{ VCORE_TABLE_0 },
		{ VCORE_TABLE_1 },
		{ VCORE_TABLE_2 },
};

spower_raw_t cpu_spower_raw = {
	.vsize = VSIZE,
	.tsize = TSIZE,
	.table_size = 3,
	.table = { (int *)&cpu_leakage_data[0], (int *)&cpu_leakage_data[1], (int *)&cpu_leakage_data[2] },
};

spower_raw_t lte_spower_raw = {
	.vsize = VSIZE,
	.tsize = TSIZE,
	.table_size = 3,
	.table = { (int *)&lte_leakage_data[0], (int *)&lte_leakage_data[1], (int *)&lte_leakage_data[2] },
};

spower_raw_t vcore_spower_raw = {
	.vsize = VSIZE,
	.tsize = TSIZE,
	.table_size = 3,
	.table = { (int *)&vcore_leakage_data[0], (int *)&vcore_leakage_data[1], (int *)&vcore_leakage_data[2] },
};



typedef struct voltage_row_s {
	int mV[VSIZE];
} vrow_t;
	
typedef struct temperature_row_s {
	int deg;
	int mA[VSIZE];
} trow_t;
	
	
typedef struct sptab_s {
	int vsize;
	int tsize;
	int *data; 		// array[VSIZE + TSIZE + (VSIZE*TSIZE)];
	vrow_t *vrow; 		// pointer to voltage row of data
	trow_t *trow;		// pointer to temperature row of data
} sptbl_t;

#define trow(tab, ti)		((tab)->trow[ti])
#define mA(tab, vi, ti) 	((tab)->trow[ti].mA[vi])
#define mV(tab, vi) 		((tab)->vrow[0].mV[vi])
#define deg(tab, ti)	 	((tab)->trow[ti].deg)
#define vsize(tab)		((tab)->vsize)
#define tsize(tab)		((tab)->tsize)
#define tab_validate(tab)	(!!(tab) && (tab)->data != NULL)

static inline void spower_tab_construct(sptbl_t (*tab)[], spower_raw_t *raw)
{
	int i;
        sptbl_t *ptab = (sptbl_t *)tab;

	for (i=0; i<raw->table_size; i++) {
		ptab->vsize = raw->vsize;
		ptab->tsize = raw->tsize;
		ptab->data = raw->table[i];
		ptab->vrow = (vrow_t *)ptab->data;
		ptab->trow = (trow_t *)(ptab->data + ptab->vsize);
		ptab++;
	}
}



#endif


